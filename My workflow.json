{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -16,
        -16
      ],
      "id": "78932147-2ce4-4e98-843e-2a8576bffdbd",
      "name": "When chat message received",
      "webhookId": "20ce5db8-b511-4f9d-9e2c-d3d4c7629ce1"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=Eres una asistente virtual profesional encargada de la agenda del Dr. Galan.\nFECHA Y HORA ACTUAL: {{ $now.setZone('America/Guayaquil').toFormat('cccc d MMMM yyyy, h:mm a') }}\n\nOBJETIVO: Agendar citas revisando disponibilidad real.\n\nTUS HERRAMIENTAS:\n1. 'Herramienta_Leer_Calendario': Trae los próximos 50 eventos.\n2. 'Herramienta_Agendar_Cita': Crea el evento.\n\nCÓMO PROCESAR LA DISPONIBILIDAD (CRÍTICO):\n1. Cuando ejecutes 'Herramienta_Leer_Calendario', recibirás una lista de eventos mezclados.\n2. TU TRABAJO ES FILTRAR:\n   - Mira la propiedad 'start dateTime' de cada evento.\n   - Compárala con el día que pidió el usuario.\n   - SI LA FECHA NO COINCIDE: Ignora ese evento. No cuenta como ocupado para el día solicitado.\n   - SI LA LISTA NO TIENE EVENTOS DEL DÍA PEDIDO: Significa que ese día está LIBRE.\n\nEJEMPLO DE PENSAMIENTO:\n\"El usuario pidió Miércoles 26. La herramienta trajo eventos del Martes 25.\nConclusión: No veo nada para el Miércoles 26 en la lista.\nRespuesta: El Miércoles 26 está totalmente libre.\"\n\nREGLAS DE CONVERSACIÓN:\n- Sé amable y breve.\n- Si está libre, propón horarios.\n- Si está ocupado, busca el hueco más cercano.\n- Al agendar, usa una duración de 1 hora."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        352,
        -192
      ],
      "id": "c33bc12e-4422-40c9-b299-96ea258c389e",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        336,
        96
      ],
      "id": "6bf2a622-edf1-4b15-920e-afca24185795",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "aqs1lgYB5ywbsXXZ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "yolotime2322@gmail.com",
          "mode": "list",
          "cachedResultName": "yolotime2322@gmail.com"
        },
        "limit": 100,
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        688,
        48
      ],
      "id": "f8644d4b-0409-4cf1-a00c-fb06e6ec579b",
      "name": "Herramienta_Leer_Calendario",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mcrhgmy0PrMPXYVD",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "yolotime2322@gmail.com",
          "mode": "list",
          "cachedResultName": "yolotime2322@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "description": "Agendado por IA.",
          "summary": "Cita Dental - Paciente."
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        800,
        -80
      ],
      "id": "fe838444-7565-43e8-84bb-e1c7a18c6afc",
      "name": "Herramienta_Agendar_Cita",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mcrhgmy0PrMPXYVD",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        512,
        80
      ],
      "id": "1ac44f5a-8d91-472a-b46e-685ba26bf101",
      "name": "Simple Memory"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Herramienta_Leer_Calendario": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Herramienta_Agendar_Cita": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "dcdbf062-5aec-47c2-890c-5a52f489f2ca",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "84fda98b68ab0387a202aaa0173e89cfcf231135da88e07260a9b7d074ec6eeb"
  },
  "id": "9oBM0wvjcp53yJRx",
  "tags": []
}